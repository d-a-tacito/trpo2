name: Generate README

on:
  push:
    branches:
      - release

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Get Commit Information
      id: get_commit_info
      run: |
        echo "COMMIT_MESSAGE<<EOF" >> $GITHUB_ENV
        git log -1 --pretty=%B >> $GITHUB_ENV
        echo "EOF" >> $GITHUB_ENV
        echo "COMMIT_HASH<<EOF" >> $GITHUB_ENV
        git rev-parse HEAD >> $GITHUB_ENV
        echo "EOF" >> $GITHUB_ENV

    - name: Generate README.md
      run: |
        echo "# Project Name" > README.md
        echo "## Latest Commit" >> README.md
        echo "### Commit Hash: ${{ env.COMMIT_HASH }}" >> README.md
        echo "### Commit Message: ${{ env.COMMIT_MESSAGE }}" >> README.md
        echo "### Date: $(date)" >> README.md
        echo "## Description" >> README.md
        echo "This README file was automatically generated." >> README.md
  
    - name: Commit and Push README
      run: |
        git config --local user.name "github-actions"
        git config --local user.email "github-actions@github.com"
        git add README.md
        git commit -m "Update README.md for commit ${{ env.COMMIT_HASH }}"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.FOR_TRPO2 }}
